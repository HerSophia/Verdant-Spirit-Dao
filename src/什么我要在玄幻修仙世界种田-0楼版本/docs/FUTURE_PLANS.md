# 未来功能拓展路线图 (FUTURE_PLANS.md) v1.1

本文档旨在将我们对《玄幻修仙世界种田》未来的畅想，转化为一个清晰、可执行的开发路线图。所有新功能都将基于现有稳固的模块化和事件驱动架构进行设计，并按照实施难度由易到难进行排序。

## **阶段四：较高难度 (涉及复杂核心逻辑)**

这些功能通常是某一类玩法的核心，需要精心设计数据结构和多系统交互逻辑。

### **1. 生产技能系统 (炼丹/炼器/阵法)**

* **构想**: 允许玩家收集材料，通过一个专用的UI界面，制造丹药、法器或布置阵法。
* **可行方案**:
    1. **定义复杂系统**: 在 `SYSTEMS_SPEC.md` 中定义一个复杂的系统，如 `'炼丹炉'`，它需要包含玩家已解锁的“丹方”列表、当前放入的药材、成丹率等。
    2. **创建Prompt模块**: 创建 `system_alchemy.md`。此模块的挑战在于，一次“炼丹”行为是**复合事件**的极致体现：它需要处理**失去**多种材料 (`物品变化`)、**获得**丹药 (`物品变化`)、可能发现**新丹药** (`新图鉴发现`)、可能提升**技能熟练度** (`技能提升`) 等多个事件。
    3. **事件与UI交互**: `core/systems.ts` 中对应的 `renderAlchemySystem` 需要提供一个**可交互**的UI，允许玩家选择丹方、放入药材。点击“开始炼制”按钮后，会触发一个特殊的 `action`，将选择的配方发送给LLM，由LLM判断结果并返回一系列事件。

### **2. 探索与副本系统**

* **构想**: 玩家可以进入一个有边界的特殊区域（如“秘境”、“古修士洞府”）。在副本内，时间流逝、环境、遭遇都可能与主世界不同。
* **可行方案**:
    1. **状态管理**: 这是最大的挑战。需要设计一套“临时状态”或“状态堆栈”机制。进入副本时，可以将当前 `世界` 状态的一部分（如时间、地点）压入堆栈，并加载一个临时的 `世界.当前秘境` 状态。
    2. **Prompt上下文管理**: `core/generation.ts` 在构建Prompt时，需要能识别出玩家正处于“副本模式”，并注入关于这个秘境的特定上下文。
    3. **核心逻辑扩展**: `core/variables.ts` 和 `core/actions.ts` 需要增加处理“进入/离开”副本的逻辑，负责状态的切换和结算。
    4. **UI模式切换**: `core/renderer.ts` 可能需要一个 `renderDungeonMode()` 方法，在玩家进入副本时，切换到一套不同的UI布局或信息面板。

### **3. 传送系统**

* **构想**: 允许玩家在游戏中期解锁传送能力，可以快速前往曾经到访过或已知的特殊地点，极大地提升探索效率。这是一个内置系统，但需要由叙事驱动来解锁。
* **可行方案**:
    1. **状态定义**: 在 `VARIABLES_SPEC.md` 的 `世界` 命名空间下增加 `传送点: { "已解锁": ["洄潮屿", "青石镇"], "当前激活": "洄潮屿" }`。
    2. **解锁逻辑 (LLM判断)**: 这是此功能的核心。我们需要在 `base.md` 中设计一套复杂的指令，引导LLM根据玩家的等级、探索范围、关键任务完成度、庇护所等级等多个维度，综合判断游戏是否进入“中期”。当时机成熟时，LLM会通过一个特殊的剧情或事件（例如，玩家修为突破、获得传送法宝、修复古代传送阵等）来触发传送系统的解锁，并通过 `系统确认` 事件来激活它。
    3. **UI与交互**: `core/systems.ts` 中需要一个新的 `renderTeleportSystem` 函数。这个UI会读取 `世界.传送点.已解锁` 列表，并将其渲染为一张可交互的地图或一个地点列表。点击某个地点按钮会触发一个特殊的 `action`，将目标地点发送给LLM，由LLM生成到达新地点的叙事和 `地点` 变更事件。
    4. **新地点解锁**: 新传送点的发现和解锁也完全由叙事驱动。当玩家首次到达一个重要地点时，LLM应生成事件来更新 `世界.传送点.已解锁` 列表。
