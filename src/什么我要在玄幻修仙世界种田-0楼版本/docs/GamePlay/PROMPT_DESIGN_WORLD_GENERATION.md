# 设计文档：初始世界生成综合性Prompt

本文档详细定义了在游戏开始时，用于动态生成初始地图和世界观细节的综合性Prompt。

## 1. 目标

此Prompt的核心目标是指导LLM扮演“世界构建大师”的角色，根据玩家在开局时的一系列选择，创造一个独一无二、充满探索潜力的个性化游戏开局。LLM的输出必须是结构化的、可被程序直接解析的JSON对象。

## 2. 输入上下文 (Inputs)

在调用LLM之前，系统需要收集并格式化以下两类信息作为Prompt的输入：

### 2.1. 核心世界观 (`core_worldview`)

一段关于游戏宏观背景的总结性描述，提炼自 `项目总结和介绍.md`。

**示例**:

```
"你将要构建的世界名为‘元初界’，是一个玄幻修仙世界。玩家扮演一位意外穿越到此的现代农学学生，流落到一个名为‘洄潮屿’的神秘海岛上。核心玩法围绕‘种田’、‘生存’和‘探索’展开，风格为慢节奏养成。弱化战斗，强调利用知识和智慧创造生活。"
```

### 2.2. 玩家开局设定 (`player_setup`)

一个结构化的对象，包含了玩家在 `SetupModule` 中做出的所有选择。

**示例**:

```json
{
  "环境": {
    "灵田": "十五亩 (广阔完整)",
    "水源": "水源稀缺 (需净化海水)",
    "生物": "危机四伏 (部分生物有攻击性)",
    "海底": "深海海沟 (地形复杂，暗藏遗迹)",
    "风暴": "风和日丽 (风暴罕见)",
    "岛屿": "孤岛 (海域唯一陆地)"
  },
  "心态": "探究者 (解析世界是最大的乐趣)",
  "凡人特长": "动手达人 (能更快制作和修复工具)",
  "初始位置": "海滩 (连接着墨绿色的森林)"
}
```

## 3. Prompt 结构

```
# 角色
你是一位经验丰富的文字冒险游戏（MUD）的世界构建大师和地下城主（DM）。

# 任务
你的任务是为一个名为《什么？我要在玄幻修仙世界种田？》的游戏生成个性化的开局世界。你必须严格根据我提供的【核心世界观】和【玩家开局设定】，生成一个结构化的JSON对象作为回复。

## 规则
1.  **严格的JSON格式**: 你的回复必须是一个完整的、可被解析的JSON对象，不能包含任何JSON格式之外的解释性文字。
2.  **叙事驱动**: 所有生成的内容都应服务于叙事，并与玩家的选择紧密相连。
3.  **创造力与一致性**: 在遵循设定的前提下，发挥你的创造力，让每个开局都充满独特的魅力和神秘感。

---

## 输入信息

### 核心世界观
{{core_worldview}}

### 玩家开局设定
```json
{{player_setup}}
```

---

## 输出要求

请根据以上输入信息，生成一个包含 `initial_map` 和 `worldview_details` 两个顶级键的JSON对象。

### 1. `initial_map`

生成一个包含3到5个互相关联区域的初始地图。

- 玩家的初始位置（`currentPlayerLocation`）必须是【玩家开局设定】中选择的地点。
- 地图区域的特征应反映玩家选择的【环境】设定。例如，如果玩家选择了“深海海沟”，初始区域附近就应该有一个通往海边的连接，且描述中可以暗示深海的危险。
- 严格遵循以下数据结构：

    ```json
    {
      "rumors": [ { "content": "...", "type": "hook", "source_location": "（可选）传闻最可能发源的地点", "related_entities": ["..."] } ],
      "pokedex_entries": [ { "名称": "...", "类别": "妖兽 | 植物", "描述": "...", "习性": "..." } ],
      "adventure_hooks": [ { "描述": "...", "触发条件": "当玩家表现出[探究者]特质时（例如：研究未知物品）" } ]
    }
    ```

### 2. `worldview_details`

生成一系列“待发现”的叙事元素，用于丰富世界。这些内容将作为背景资料供后续游戏参考，不会立即展示给玩家。

- 所有内容都必须与【玩家开局设定】紧密相关。
- **`rumors`**: 生成1-2条长期传闻线索。
  - 如果玩家选择了“孤岛”，可以生成一条关于“为何此地是唯一陆地”的古老传说。
  - 传闻类型应为 `'hook'`，为玩家提供长期的探索目标。
- **`pokedex_entries`**: 生成1-2个独特的图鉴条目。
  - 必须与玩家选择的【环境】（生物、海底等）相关。例如，选择了“危机四伏”，就创造一种独特的攻击性生物。
- **`adventure_hooks`**: 生成1条奇遇线索。
  - 必须与玩家选择的【心态】或【凡人特长】相关。例如，选择了“探究者”，可以设计一个关于古代遗迹或神秘符号的发现之旅的开端。
- 严格遵循以下数据结构：

    ```json
    {
      "rumors": [ { "content": "...", "type": "hook", "source_location": "（可选）传闻最可能发源的地点", "related_entities": ["..."] } ],
      "pokedex_entries": [ { "名称": "...", "类别": "妖兽 | 植物", "描述": "...", "习性": "..." } ],
      "adventure_hooks": [ { "描述": "...", "触发条件": "当玩家表现出[探究者]特质时（例如：研究未知物品）" } ]
    }
    ```

---

请现在开始生成完整的JSON输出。

```json

```

## 4. 预期输出示例 (Expected Output Example)

基于前述的【玩家开局设定】示例，一个可能的、符合规范的输出如下：

```json
{
  "initial_map": {
    "regions": {
      "beach_01": {
        "region_id": "beach_01",
        "name": "孤寂海滩",
        "description": "一片被嶙峋黑岩环绕的狭长沙滩，连接着后方墨绿色的森林。空气中弥漫着咸腥和一丝危险的气息。",
        "tags": ["beach", "starting_point", "hostile_creatures_nearby"]
      },
      "forest_01": {
        "region_id": "forest_01",
        "name": "黑岩森林",
        "description": "森林内地势崎岖，巨大的黑色岩石随处可见。一些树木呈现出不自然的扭曲形态，林间偶尔传来令人不安的嘶嘶声。",
        "tags": ["forest", "hostile", "wood_source"]
      },
      "tide_cave_01": {
        "region_id": "tide_cave_01",
        "name": "潮汐洞穴",
        "description": "一个位于海滩峭壁下的隐秘洞穴，洞口一半被海水淹没，似乎只有在退潮时才能进入。洞内隐约有微光闪烁。",
        "tags": ["cave", "mysterious", "requires_timing"]
      }
    },
    "connections": [
      {
        "from_region": "beach_01",
        "to_region": "forest_01",
        "description": "一条被人踩出的小径通向内陆的黑岩森林。",
        "direction": "内陆",
        "is_visible": true,
        "conditions": []
      },
      {
        "from_region": "beach_01",
        "to_region": "tide_cave_01",
        "description": "海滩的峭壁下有一个被潮水半淹没的洞口。",
        "direction": "峭壁下方",
        "is_visible": true,
        "conditions": ["需要退潮"]
      }
    ],
    "currentPlayerLocation": "beach_01"
  },
  "worldview_details": {
    "rumors": [
      {
        "content": "古老的海图上记载，这片海域曾是某位大能的道场，后来在一场灾变中沉入海底，唯有道场核心所在的‘洄潮屿’得以幸免，成为了唯一的陆地。",
        "type": "hook",
        "source_location": "古代海图",
        "related_entities": ["洄潮屿", "古代遗迹"]
      }
    ],
    "pokedex_entries": [
      {
        "名称": "黑岩影蛇",
        "类别": "妖兽",
        "描述": "一种通体漆黑的蛇类妖兽，善于利用岩石阴影进行伪装和突袭。其毒牙含有微弱的麻痹毒素。",
        "习性": "领地意识极强，对进入其活动范围的生灵会主动发起攻击。常见于黑岩森林。"
      }
    ],
    "adventure_hooks": [
      {
        "描述": "在修复或制作工具时，玩家可能会意外发现一块刻有奇特符文的金属碎片，这似乎是某个古代机关的一部分，激发了玩家的探究欲望。",
        "触发条件": "当玩家进行制作或修理相关的行动时"
      }
    ]
  }
}
