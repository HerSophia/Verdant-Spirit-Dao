# 游戏模块设计：“山海经”智能手机系统 (MODULE_DESIGN_PHONE.md) v1.0

本文档详细阐述了“山海经”智能手机系统的设计与实现。该系统旨在将玩家开局时获得的“没电的手机”从一个背景物品，转变为一个功能强大、可扩展、深度融入游戏核心玩法的交互式中枢。

## 1. 核心目标与哲学

*   **核心目标**: 创建一个以现代智能手机为载体的、符合修仙世界观的“法宝”系统。它不仅是信息的展示窗口，更是玩家与世界进行特殊交互的媒介。
*   **设计哲学**:
    *   **介于法宝与科技之间**: 手机的核心功能（App）在表现上是现代科技，但在实现原理上与世界的“灵气”、“天象”等超自然力量挂钩。
    *   **能源与信号驱动**: 手机的功能受到两大核心资源——“电量”和“信号”的严格限制，使其本身成为一个需要策略管理的资源系统。
    *   **模块化应用生态**: 手机的功能以一个个独立的“App”形式存在，这些App可以随着游戏进程逐步解锁或升级，为玩家提供持续的目标和奖励。
    *   **叙事深度整合**: 手机不仅是工具，更是叙事的一部分。它可以接收来自未知来源的信息，成为任务、传闻和关键剧情的发布平台。

## 2. 设计原则

*   **状态驱动**: 手机的所有UI和功能都由其在 `worldStore` 中的状态精确驱动。
*   **逻辑内聚**: 所有与手机自身状态（电量、信号）和App核心逻辑相关的代码，都封装在独立的 `phoneStore` 中。
*   **高度解耦**: `phoneStore` 不直接修改其他业务模块的状态，而是通过调用其他Store的Actions或派发全局事件来请求交互，实现清晰的职责分离。
*   **渐进式解锁**: 玩家开局时手机功能有限（甚至无法开机），需要通过探索和完成特定目标来逐步恢复和增强其功能。

## 3. 数据结构设计 (`VARIABLES_SPEC.md`)

我们将在 `世界` 命名空间下引入一个新的核心对象 `手机`。

```json
"世界": {
  // ... 其他已有变量 ...
  "手机": {
    "型号": "山海经-初代",
    "状态": "关机", // "开机", "关机", "电量耗尽"
    "电量": {
      "当前值": 0,
      "最大值": 100,
      "充电方式": "未解锁" // "太阳能", "灵气充电"
    },
    "信号": {
      "当前强度": 0, // 0-5的整数
      "来源": "无" // "双月临空", "灵气潮汐"
    },
    "已解锁应用": [
      "设置",
      "时钟"
    ],
    "应用数据": {
      "相册": [
        { "id": "pokedex_lingzhi_01", "url": "...", "拍摄时间": "Y1D3" }
      ],
      "便签": [
        { "id": "note_01", "title": "待办事项", "content": "1. 修复篱笆" }
      ]
    }
  }
}
```

*   **`状态`**: 控制手机是否可用。
*   **`电量`**: 核心资源。初始为0，需要通过 `item-solar-charger` 或未来的修仙方式充电。
*   **`信号`**: 另一核心资源。其 `来源` 和 `当前强度` 完全由 `weatherStore` 中的 `特殊天象` 决定。
*   **`已解锁应用`**: 一个字符串数组，记录玩家可以使用的App，控制UI上显示的图标。
*   **`应用数据`**: 存储各个App产生的持久化数据。

## 4. 技术方案与数据流

### 4.1 核心Store (`stores/systems/phoneStore.ts`)

`phoneStore` 是整个系统的逻辑核心。

*   **职责**:
    1.  **状态管理**: 维护 `世界.手机` 的权威状态。
    2.  **依赖监听**:
        *   `watch` 监听 `timeStore` 的时辰变化，用于处理开机状态下的电量自然消耗。
        *   `watch` 监听 `weatherStore` 的 `特殊天象` 变化，用于动态更新 `信号` 状态。
    3.  **核心Actions**:
        *   `charge(amount, type)`: 增加电量，并可能更新 `充电方式`。
        *   `togglePower()`: 切换开机/关机状态。
        *   `unlockApp(appId)`: 向 `已解锁应用` 数组中添加新的App。
    4.  **持久化**: 在状态变更后，调用 `worldStore.updateWorldState('手机', ...)` 将更新后的完整对象写回。

### 4.2 UI 实现 (`components/system/PhonePanel.vue`)

*   **职责**: 渲染一个模拟智能手机界面的UI。
*   **数据源**: 完全由 `usePhoneStore()` 驱动。
*   **实现**:
    *   UI的根元素根据 `store.phone.状态` 决定是否显示。
    *   顶部的状态栏显示 `电量` 和 `信号` 图标。
    *   主屏幕根据 `store.phone.已解锁应用` 数组，使用 `v-for` 动态渲染App图标。
    *   点击App图标会打开对应的子组件视图（例如 `WeatherApp.vue`）。

## 5. “应用”模块详解 (App Ecosystem)

手机的功能通过一个个独立的“App”来实现，每个App都是一个Vue组件，并与一个或多个核心Store交互。

### 5.1 **[初始自带]** 时钟 (ClockApp)

*   **功能**: 显示当前的游戏内日期、时辰和季节。
*   **交互**: `useTimeStore()`。
*   **解锁条件**: 手机开机。

### 5.2 **[初始自带]** 天气 (WeatherApp)

*   **功能**: 以更现代的方式展示当前天气、温度、未来天气预报。
*   **交互**: `useWeatherStore()`。
*   **解锁条件**: 手机开机。

### 5.3 **[需解锁]** 异界论坛 (BBSApp)

*   **功能**: 手机系统的核心叙事和任务分发渠道。
    *   **只读**: 玩家只能接收信息，不能回复。
    *   **信号依赖**: 只有在 `信号.当前强度 > 0` 时才能“刷新”并接收新消息。
    *   **信息来源**:
        *   **传闻**: `rumorStore` 生成的 `'hook'` 或 `'lore'` 型传闻，可以作为“帖子”推送到此App。
        *   **任务**: `questStore` 可以通过此App向玩家“私信”发布新任务。
        *   **神秘信息**: 可能是来自其他穿越者、高维存在或世界意志的meta信息。
*   **交互**: `useRumorStore()`, `useQuestStore()`。
*   **解锁条件**: 在特定的 `特殊天象` 下首次成功开机。

## 6. 与其他模块的联动

*   **`timeStore`**:
    *   **输入**: `phoneStore` 监听时间流逝以消耗电量。
    *   **输出**: `ClockApp` 读取并展示时间。
*   **`weatherStore`**:
    *   **输入**: `phoneStore` 监听 `特殊天象` 以更新信号。
    *   **输出**: `WeatherApp` 读取并展示天气。
*   **`itemStore`**:
    *   **输入**: 玩家需要使用 `太阳能充电器` 等物品来调用 `phoneStore.charge()`。
*   **`rumorStore` / `questStore`**:
    *   **输出**: 手机的各个App为这些Store的数据提供了全新的、可视化的前端界面和交互方式。

通过这个设计，手机将成为一个集信息中心、交互工具和叙事设备于一体的核心系统，将游戏的各个模块有机地串联起来，为玩家提供一个既熟悉又新颖的独特体验。
